(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/task/map"],{"0015":function(t,e,o){"use strict";o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return n}));var n={uniPopup:function(){return Promise.all([o.e("common/vendor"),o.e("uni_modules/uni-popup/components/uni-popup/uni-popup")]).then(o.bind(null,"6275"))}},i=function(){var t=this,e=t.$createElement;t._self._c},s=[]},"2f8a":function(t,e,o){"use strict";(function(t){o("d241");n(o("66fd"));var e=n(o("fa9a"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},3111:function(t,e,o){},3498:function(t,e,o){"use strict";var n=o("8db5"),i=o.n(n);i.a},"47b7":function(t,e,o){"use strict";var n=o("3111"),i=o.n(n);i.a},"8db5":function(t,e,o){},c64a:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=o("2f62");function i(t,e){var o=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.push.apply(o,n)}return o}function s(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?i(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function a(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var c,l=function(){o.e("pages/task/oldInfoShow").then(function(){return resolve(o("df22"))}.bind(null,o)).catch(o.oe)},r=o("5b7e"),u={data:function(){return{nowMapIndex:!0,phoneHeight:"",phoneWidth:"",isShowOld:!1,longitude:"",latitude:"",elderInfo:{},TaskInfo:{},FamilyTel:"",makers:[],circles:[],socketTask:null,is_open_socket:!1,timer:null,oldImage:[]}},components:{OldInfoShow:l},computed:s(s({},(0,n.mapState)(["token","uid","tel","pw","vid","picture","name"])),{},{nintyPercentScreenHeight:function(){return""!==this.phoneHeight&&""!==this.phoneWidth?750/this.phoneWidth*this.phoneHeight*.8+"rpx":"1250rpx"},seventyPercentScreenHeight:function(){return""!==this.phoneHeight&&""!==this.phoneWidth?750/this.phoneWidth*this.phoneHeight*.7+"rpx":"1000rpx"}}),created:function(){c=new r({key:"QV7BZ-6M76X-TFL4M-TGKDY-FFC76-VJF7O"});var e=this;t.getSystemInfo({success:function(t){e.phoneHeight=t.windowHeight,e.phoneWidth=t.windowWidth}})},onLoad:function(t){null!=t&&(this.elderInfo=JSON.parse(t.oldInfo),console.log(this.elderInfo.latitude),console.log(this.elderInfo.longitude),this.getLocation(this.elderInfo.latitude,this.elderInfo.longitude),this.searchPOI(this.elderInfo.latitude,this.elderInfo.longitude),this.circles=[{longitude:this.elderInfo.longitude,latitude:this.elderInfo.latitude,fillColor:"#00000000",color:"#12A1DD",radius:5e3,strokeWidth:2}],this.TaskInfo=JSON.parse(t.taskInfo),this.getFamilyTel(),this.getOldImages(),this.connectSocketInit()),console.log(this.elderInfo),console.log(this.TaskInfo)},beforeDestroy:function(){this.closeSocket()},destroyed:function(){this.closeSocket()},onShow:function(){this.connectSocketInit()},onHide:function(){this.closeSocket()},methods:{getOldImages:function(){var e=this,o="Bearer ".concat(this.token);t.request({url:"https://fwwb2020-proxy-slk.tgucsdn.com/photo/get",method:"POST",header:{"content-type":"application/json",Authorization:o},data:{eid:e.elderInfo.eid},success:function(o){if(console.log(o.data),200==o.data.status){var n=o.data.data.photo;console.log(n),e.oldImage.splice(0,0,n.photo1),e.oldImage.splice(1,0,n.photo2),e.oldImage.splice(2,0,n.photo3),console.log(e.oldImage)}else t.showToast({title:"".concat(o.data.msg),icon:"none",mask:!0,image:"../../static/img/error.png"})},fail:function(e){t.showToast({title:"获得失败！",icon:"none",mask:!0,image:"../../static/img/error.png"})}})},getFamilyTel:function(){var e=this,o="Bearer ".concat(this.token);t.request({url:"https://fwwb2020-proxy-slk.tgucsdn.com/user/getUserByUid",method:"POST",header:{"content-type":"application/json",Authorization:o},data:{uid:e.elderInfo.uid},success:function(o){console.log(o.data),200==o.data.status?e.FamilyTel=o.data.data.user.tel:t.showToast({title:"".concat(o.data.volunteerItem),icon:"none",mask:!0,image:"../../static/img/error.png"})},fail:function(e){t.showToast({title:"获得失败！",icon:"none",mask:!0,image:"../../static/img/error.png"})}})},open:function(){this.$refs.popup.open()},getLocation:function(e,o){var n=this,i=this;t.getLocation({type:"gcj02",success:function(t){n.latitude=t.latitude,n.longitude=t.longitude,i.makers=[{id:0,latitude:e,longitude:o,iconPath:"../../static/img/lostOld.png",width:40,height:40,title:"老人走失位置"}]}}),console.log(this.makers)},getLocation2:function(){var e=this;t.getLocation({type:"gcj02",success:function(t){e.latitude=t.latitude,e.longitude=t.longitude}})},searchPOI:function(t,e){var o=this;c.search({keyword:"警察局",location:{latitude:t,longitude:e},page_size:20,success:function(t){console.log(t.data);for(var e=0;e<t.data.length;e++){var n={};n.title=t.data[e].title,n.id=e+2,n.latitude=t.data[e].location.lat,n.longitude=t.data[e].location.lng,n.iconPath="../../static/img/icon-location.png",n.width=20,n.height=20,o.makers.splice(e+1,0,n)}},fail:function(t){console.log(t)}}),c.search({keyword:"医院",location:{latitude:t,longitude:e},page_size:20,success:function(t){console.log(t.data);for(var e=0;e<t.data.length;e++){var n={};n.title=t.data[e].title,n.id=20+e,n.latitude=t.data[e].location.lat,n.longitude=t.data[e].location.lng,n.iconPath="../../static/img/icon-location.png",n.width=20,n.height=20,o.makers.splice(e+20,0,n)}},fail:function(t){console.log(t)}}),console.log(o.makers)},OldInfo:function(){this.isShowOld=!0,console.log(this.isShowOld)},onClose:function(){this.isShowOld=!1,console.log(this.isShowOld)},userChat:function(){t.navigateTo({url:"../function/userChat?taskID="+this.TaskInfo.tid})},faceRecognition:function(){var e=this;console.log(e.TaskInfo.tid),t.navigateTo({url:"../function/faceRecognition?tid="+e.TaskInfo.tid+"&eid="+e.elderInfo.eid})},connectSocketInit:function(){var e=this,o=this;this.socketTask=t.connectSocket({url:"wss://fwwb2020-proxy-slk.tgucsdn.com/websocket/location/"+o.TaskInfo.tid,success:function(t){console.log("websocket连接成功")}}),this.socketTask.onOpen((function(t){console.log("WebSocket连接正常打开中...！"),o.is_open_socket=!0;var n=o.makers.length;e.socketTask.onMessage((function(t){console.log(n);var e=JSON.parse(t.data);console.log(e),e.forEach((function(t,n){Number(e.tid);var i={};i.id=30+n,i.latitude=t.latitude,i.longitude=t.longitude,i.title=t.name,i.iconPath=t.picture,i.width=20,i.height=20,console.log(i),o.makers.splice(30+n,1,i)})),console.log(o.makers)})),null==o.timer&&(o.timer=setInterval((function(){o.getLocation2();var t={vid:o.vid,tid:o.TaskInfo.tid,picture:o.picture,name:o.name,longitude:o.longitude,latitude:o.latitude};t=JSON.stringify(t),o.socketTask.send({data:t})}),1e3))})),this.socketTask.onClose((function(){console.log("已经被关闭了")}))},closeSocket:function(){var t=this;clearInterval(this.timer),this.timer=null,this.socketTask.close({success:function(e){t.is_open_socket=!1,console.log("关闭成功",e)},fail:function(t){console.log("关闭失败",t)}})}}};e.default=u}).call(this,o("543d")["default"])},d63d:function(t,e,o){"use strict";o.r(e);var n=o("c64a"),i=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);e["default"]=i.a},fa9a:function(t,e,o){"use strict";o.r(e);var n=o("0015"),i=o("d63d");for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);o("47b7"),o("3498");var a,c=o("f0c5"),l=Object(c["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],a);e["default"]=l.exports}},[["2f8a","common/runtime","common/vendor"]]]);