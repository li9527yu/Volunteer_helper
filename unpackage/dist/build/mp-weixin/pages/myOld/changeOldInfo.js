(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/myOld/changeOldInfo"],{"5df0":function(e,t,n){"use strict";n.r(t);var o=n("5e6b"),i=n("bb32");for(var a in i)"default"!==a&&function(e){n.d(t,e,(function(){return i[e]}))}(a);var s,l=n("f0c5"),c=Object(l["a"])(i["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],s);t["default"]=c.exports},"5e6b":function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return o}));var o={uniForms:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(n.bind(null,"35fd"))},uniFormsItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(n.bind(null,"41e4"))},uniEasyinput:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput")]).then(n.bind(null,"3c21"))},uniDataCheckbox:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-data-checkbox/components/uni-data-checkbox/uni-data-checkbox")]).then(n.bind(null,"eab5"))},uniDatetimePicker:function(){return n.e("uni_modules/uni-datetime-picker/components/uni-datetime-picker/uni-datetime-picker").then(n.bind(null,"a453"))},uniFilePicker:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uni-file-picker/components/uni-file-picker/uni-file-picker")]).then(n.bind(null,"f500"))},uniRow:function(){return n.e("uni_modules/uni-row/components/uni-row/uni-row").then(n.bind(null,"8719"))},uniCol:function(){return n.e("uni_modules/uni-row/components/uni-col/uni-col").then(n.bind(null,"cc0e"))}},i=function(){var e=this,t=e.$createElement;e._self._c},a=[]},bb32:function(e,t,n){"use strict";n.r(t);var o=n("eb11"),i=n.n(o);for(var a in o)"default"!==a&&function(e){n.d(t,e,(function(){return o[e]}))}(a);t["default"]=i.a},c8c3:function(e,t,n){"use strict";(function(e){n("d241");o(n("66fd"));var t=o(n("5df0"));function o(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},eb11:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n("2f62");function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){s(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n("5b7e");var l={data:function(){return{flag:!1,Oldinfo:{address:"",back_card:"",city:"",district:"",front_card:"",gender:0,latitude:"",longitude:"",name:"",place:"",level:"",province:"",birthday:"",height:"",uid:"",eid:"",status:"",pid:""},oldInfo:{},value:0,Dvalue:1,range:[{value:0,text:"男"},{value:1,text:"女"}],diseases:[{value:1,text:"轻微"},{value:2,text:"中度"},{value:3,text:"严重"}],date:"",changeStatus:!0,Oldimage:[],sendImage:[],TempImg:[],imageNum:0,pid:""}},computed:a(a({},(0,o.mapState)(["token","uid","tel","pw"])),{},{infoStatus:function(){return this.flag?"完成":"修改信息"}}),methods:{getOldImage:function(){var t=this,n="Bearer ".concat(this.token);e.request({url:"https://fwwb2020-proxy-slk.tgucsdn.com/photo/get",method:"POST",data:{eid:t.Oldinfo.eid},header:{Authorization:n,"Content-Type":"application/json"},success:function(e){if(console.log(e.data),200==e.data.status){var n=e.data.data.photo;if(t.pid=n.pid,null!=n.photo1){var o={name:"photo1",extname:"png",url:n.photo1};t.Oldimage.push(o),t.TempImg.push(n.photo1)}if(null!=n.photo2){var i={name:"photo2",extname:"png",url:n.photo2};t.Oldimage.push(i),t.TempImg.push(n.photo2)}if(null!=n.photo3){var a={name:"photo3",extname:"png",url:n.photo3};t.Oldimage.push(a),t.TempImg.push(n.photo3)}}},fail:function(e){console.log(e)}}),console.log(t.Oldimage)},chooseLocation:function(){var t=this;e.chooseLocation({success:function(e){t.Oldinfo.latitude=e.latitude,t.Oldinfo.longitude=e.longitude,t.Oldinfo.address=e.address,t.Oldinfo.place=e.name,t.analysisLocation(e.latitude,e.longitude)}})},dateChange:function(e){this.Oldinfo.birthday="".concat(e)},genderChange:function(e){console.log(e),this.Oldinfo.gender=e.detail.value},diseaseChange:function(e){console.log(e),this.Oldinfo.level=e.detail.value,console.log(this.Oldinfo.level)},selectImg:function(t){var n=this;console.log("选择文件：",t);var o=t.tempFilePaths,i="Bearer ".concat(this.token);e.uploadFile({url:"https://fwwb2020-proxy-slk.tgucsdn.com/file/upload",header:{Authorization:i,"Content-Type":"multipart/form-data"},filePath:o[0],name:"photo",success:function(o){console.log(JSON.parse(o.data));var i=JSON.parse(o.data);if(202==i.status){n.imageNum++,console.log(n.imageNum),3==n.imageNum?e.showToast({mask:!0,image:"../../static/img/success.png",icon:"none",title:"图片上传成功"}):e.showToast({mask:!0,image:"../../static/img/success.png",icon:"none",title:"图片正在上传"});var a={};a.tempPath=t.tempFilePaths[0],a.Path=i.data.url,console.log(a),n.sendImage.push(a)}},fail:function(e){console.log(e)}})},deleteIamge:function(e){var t=this;if(console.log(e),0==this.sendImage.length)t.Oldimage.pop();else{var n=this.sendImage;n.forEach((function(n,o){e.tempFilePath==n.tempPath&&(t.sendImage.splice(o,1),t.imageNum--)}))}},changeInfo:function(){var t=this,n="Bearer ".concat(this.token);if(this.flag){if(console.log(this.Oldinfo),!this.Oldinfo.birthday)return void e.showToast({mask:!0,image:"../../static/img/error.png",icon:"none",title:"请填写出生日期"});if(!this.Oldinfo.height)return void e.showToast({mask:!0,image:"../../static/img/error.png",icon:"none",title:"请填写身高"});if(!this.Oldinfo.address)return void e.showToast({mask:!0,image:"../../static/img/error.png",icon:"none",title:"请填写居住位置"});if(0==t.sendImage.length&&0==this.Oldimage.length)return void e.showToast({title:"请先选择照片",icon:"none",mask:!0,image:"../../static/img/error.png"});if(t.sendImage.length>0&&t.sendImage.length<3&&0==this.Oldimage.length)return void e.showToast({title:"请上传三张图片",icon:"none",mask:!0,image:"../../static/img/error.png"});if(0!=this.sendImage.length||0!=this.TempImg.length){console.log(t.sendImage.length),console.log(t.TempImg.length);for(var o=0;o<3;o++)void 0!=this.sendImage[o]&&(this.TempImg[o]=this.sendImage[o].Path);var i=this.TempImg[0],a=this.TempImg[1],s=this.TempImg[2];console.log(i),console.log(a),console.log(s),e.request({url:"https://fwwb2020-proxy-slk.tgucsdn.com/photo/change",method:"POST",header:{"content-type":"application/json",Authorization:n},data:{eid:t.Oldinfo.eid,photo1:i,photo2:a,photo3:s,pid:t.pid},success:function(t){console.log(t.data),200==t.data.status?e.showToast({title:"完善照片成功",icon:"none",mask:!0,image:"../../static/img/success.png"}):e.showToast({title:"".concat(t.data.msg),icon:"none",mask:!0,image:"../../static/img/error.png"})},fail:function(t){e.showToast({title:"完善照片失败！",icon:"none",mask:!0,image:"../../static/img/error.png"})}})}e.request({url:"https://fwwb2020-proxy-slk.tgucsdn.com/elder/change",method:"POST",header:{"content-type":"application/json",Authorization:n},data:{address:t.Oldinfo.address,eid:t.Oldinfo.eid,city:t.Oldinfo.city,district:t.Oldinfo.district,birthday:t.Oldinfo.birthday,gender:t.Oldinfo.gender,height:t.Oldinfo.height,latitude:t.Oldinfo.latitude,level:t.Oldinfo.level,longitude:t.Oldinfo.longitude,name:t.Oldinfo.name,place:t.Oldinfo.place,province:t.Oldinfo.province,uid:t.Oldinfo.uid},success:function(t){console.log(t.data),200==t.data.status?(e.showToast({title:"修改成功",icon:"none",mask:!0,image:"../../static/img/success.png"}),setTimeout((function(){e.switchTab({url:"./oldPeople"})}),1e3),console.log(t.data)):e.showToast({title:"".concat(t.data.msg),icon:"none",mask:!0,image:"../../static/img/error.png"})},fail:function(t){e.showToast({title:"修改失败！",icon:"none",mask:!0,image:"../../static/img/error.png"})}})}else this.changeStatus=!1,this.flag=!0,console.log(t.sendImage)}},onLoad:function(e){if(null!=e){var t=JSON.parse(e.oldInfo);t.back_card=decodeURIComponent(t.back_card),t.front_card=decodeURIComponent(t.front_card),this.Oldinfo=t,this.getOldImage(),this.date=this.Oldinfo.birthday,this.Dvalue=this.Oldinfo.level,this.value=this.Oldinfo.gender}console.log(this.Oldinfo)}};t.default=l}).call(this,n("543d")["default"])}},[["c8c3","common/runtime","common/vendor"]]]);